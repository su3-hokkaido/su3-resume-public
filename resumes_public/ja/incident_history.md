# 自身で最も良い経験となった障害

## 概要

データセンターのネットワーク障害によりマスタDBへのアクセスが不可能となった。
それに伴いレプリDBをマスタDBに切り替えたものの、切り替え前のDBをプライマリーのままとしてしまい、DCのネットワーク復旧後にプライマリDBが2つとなったことでデータの不整合が発生した。


## 発生時期

2022年9月


## 体制

以下のような体制で障害対応を行いました。
私はプロダクト開発チームのコマンダーを務めました。

- VPoE（最終決定やリーガルとの調整）
- PdM（リエゾンの役割＋プロダクト影響の判断）
- CSチーム（対外的なコミュニケーション）
- プロダクト開発チーム
  - インシデントコマンダー（こちらが私が担当したポジションです）
  - Deputy IC x 2
  - SME x 8
  - SRE x 3


## 課題

- ユーザー同士のリクエストが錯綜してしまい、ユーザー間でデータの上書きし合いが発生した。
- ユーザー同士で他ユーザーのデータを閲覧することができた。
- そのため、これらのデータの不整合を解消した上でサービス復旧を行う必要があった。


## 対応内容

- 発生した事象の視覚化と原因の調査
- 社内外の各関係サービスへの調整依頼（データ受領停止、処理中断、支払いデータの確認など）
- 消失または上書きされた可能性のあるデータの洗い出し
- 他ユーザーへのデータ漏えいの確認
- ユーザーへの謝罪内容の精査
- 障害対応にかかるシフト調整


## 結果

- 入社してから提唱していたアーキテクチャ刷新について推進をする機運を高めることができた。
- 運用しているサービスの脆弱性、アーキテクチャの問題点を洗い出すことができた。
- インシデント対応を行うにはマニュアルを用意するだけではなく、それを即座に行うことができるようにトレーニングを行う必要があることを学んだ。
- オンコール対応の体制を整える必要があることを理解した。
